<html>
	<head>
	<!--
	 Push Example -------------------------V1
     * Author:		Gianluca Guarini
	 * Contact: 	gianluca.guarini@gmail.com
	 * Website:		http://www.gianlucaguarini.com/
	 * Twitter:		@gianlucaguarini
     Broadcast    -------------------------V2
     * Author:		Carlos García
	 * Contact: 	carlucho.garcia@gmail.com
	 * Twitter:		@akakrlos
     colaborador --------------------------v2
     * Author:		Jean De Andrade
	 * Contact: 	Jeancufm@gmail.com
	 * Twitter:		@jeancufm
	-->
		<title>Dev Chat ;)</title>
    	<link type="text/css" rel="stylesheet" href="chat.css" />
		<style>
			body{
				font-family: verdana;
				font-size: 12px;
                background-color: #666666;
			}

			.time{
				font-family: verdana;
				font-size: 9px;
				background-color: #494949;
				padding: 2px;
				padding-left: 5px;
				border-radius:5px;
				border-top-left-radius:0px;
				border-top-right-radius:0px;
				border-top:0px;
				width: 400px;
				margin-left: 6px;
				margin-bottom: 5px;
                color:#f7f7f7;
			}

			.container {
				border:2px solid #494949;
				background-color: #494949;
				/*padding: 10px;*/
				border-radius:5px;
				width: 40%;

			}

			.header{
				font-family: verdana;
				font-size: 14px;
				background-color: #d1d1d1;
				padding: 10px;
				padding-left: 10px;
				border-radius:10px;
				border-top-left-radius:0px;
				border-top-right-radius:0px;
				border-top:0px;
				width: 98%;
			}
            
            #mensaje {
                width: 564px;
                height: 50px;
                border: 0px;
                border:2px solid #494949;
				padding: 10px;
				border-radius:5px;
				font-size: 14px;
                margin-bottom: 5px;
                margin-top: 5px;
            }

		</style>
        
	</head>
	<body topmargin="0">
		<div class="header">[Dev Chat :D] De los desarrolladores para los desarrolladores.</div>
		
		<div class="connected">
			<img src="unnamed.jpg" id="creatorImage" />
			<div class="infoConnected">
				<h2>Create your avatar</h2>
				<br/>
				<form class="loginForm">
					<input type="text" id="nickName" placeholder="Nick name" /><br/>
					<input type="submit" id="enterChat" value="ENTER" />
				</form>
			</div>
		</div>
        
        <div class="chatscreen">
            <div id="itemsContainer">
                <ul class="chats">
                    <!--Mensajes aquí!-->
                </ul>
            </div>
        </div>
    <footer>
        <div class="chatform">
            <input type="text" placeholder="Escriba un mensaje..."  id="Mensaje" />
        </div>
    </footer>
	<script src="socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script src="chat.js"></script>
	<script>
        
        function pastelColors(){
    var r = (Math.round(Math.random()* 127) + 127).toString(16);
    var g = (Math.round(Math.random()* 127) + 127).toString(16);
    var b = (Math.round(Math.random()* 127) + 127).toString(16);
    return '#' + r + g + b;
}
        
     $(document).ready(function(){
         $.color = pastelColors();
     });
     
     var chatForm = $(".chatform"); 
     var chats = $(".chats");
	 var socket = io.connect('http://localhost:8899');
	  socket.on('news', function (data) {
        
        var name = $("#nickName").val();
		var who = '';

		if(data.user===name) {
			who = 'me';
		}
		else {
			who = 'you';
		}
        
	    var obj = $('<li class="'+ who +'">' +
                        '<div class="image">' +
                            '<img src=' + data.avatar + ' />' +
                            '<b>' + data.user + '</b>' +
                        '</div>' +
                        // '<div class="container" style="background-color:' + data.color + '">'
                        '<p style="background-color:' + data.color + '">'
                            + data.data +
                        '</p>' +
                        // '</div>' +
                        // '<div class="time">' +
                        //     '<time>'+new Date()+'</time>' +
                        // '</div>' +
                    '</li>');
	    // $('#itemsContainer').prepend(obj);
        chats.prepend(obj);
	    $(".header").fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);
	    socket.emit('my other event', { my: 'data' })
        notifyMe(data.data);
	  });
	
    $('#Mensaje').keyup(function(e){
    if(e.keyCode == 13)
    {
		e.preventDefault();
        $(this).trigger("enterKey");
    }
});
    
    $('#Mensaje').bind("enterKey",function(e){
        if($('#Mensaje').val()!=""){
            enviar();
        }
    });
    
        function enviar () {
             $.ajax({
                type: 'POST',
                url: 'http://localhost:8899/notificaciones',
                data: '{"user":"' + $.nombreUsuario + '","avatar":"unnamed.jpg","data":'+'"'+$('#Mensaje').val()+'","color":"'+$.color+'"}',
                contentType: "application/json",
                success: function(data) {  $('#Mensaje').val(''); },
                dataType: 'json'
            });
        }
        
  function notifyMe(Mensaje) {
  // Let's check if the browser supports notifications
  if (!("Notification" in window)) {
   // alert("This browser does not support desktop notification");
  }

  // Let's check if the user is okay to get some notification
  else if (Notification.permission === "granted") {
    // If it's okay let's create a notification
    //var notification = new Notification(Mensaje);
    
    var options = {icon:'logo.png',  body:Mensaje  };
    
    var notification = new Notification("Nuevo mensaje:",options);
    
  }

  // Otherwise, we need to ask the user for permission
  // Note, Chrome does not implement the permission static property
  // So we have to check for NOT 'denied' instead of 'default'
  else if (Notification.permission !== 'denied') {
    Notification.requestPermission(function (permission) {

      // Whatever the user answers, we make sure we store the information
      if(!('permission' in Notification)) {
        Notification.permission = permission;
      }

      // If the user is okay, let's create a notification
      if (permission === "granted") {
        var notification = new Notification(Mensaje);
      }
    });
  }

  // At last, if the user already denied any notification, and you 
  // want to be respectful there is no need to bother him any more.
} 
    
	</script>
    </body>
</html>
