<html>
	<head>
	<!--
	 * Author:		Gianluca Guarini
	 * Contact: 	gianluca.guarini@gmail.com
	 * Website:		http://www.gianlucaguarini.com/
	 * Twitter:		@gianlucaguarini
	-->
		<title>Push notification server</title>
		<style>
			body{
				font-family: verdana;
				font-size: 12px;
                background-color: #666666;
			}

			.time{
				font-family: verdana;
				font-size: 9px;
				background-color: #494949;
				padding: 2px;
				padding-left: 5px;
				border-radius:5px;
				border-top-left-radius:0px;
				border-top-right-radius:0px;
				border-top:0px;
				width: 400px;
				margin-left: 6px;
				margin-bottom: 5px;
                color:#f7f7f7;
			}

			.container {
				border:2px solid #494949;
				background-color: #494949;
				padding: 10px;
				border-radius:5px;
				width: 40%;

			}

			.header{
				font-family: verdana;
				font-size: 14px;
				background-color: #d1d1d1;
				padding: 10px;
				padding-left: 10px;
				border-radius:10px;
				border-top-left-radius:0px;
				border-top-right-radius:0px;
				border-top:0px;
				width: 98%;
			}
            
            #mensaje {
                width: 564px;
                height: 50px;
                border: 0px;
                border:2px solid #494949;
				padding: 10px;
				border-radius:5px;
				font-size: 14px;
                margin-bottom: 5px;
                margin-top: 5px;
            }

		</style>
	</head>
	<body topmargin="0">
		<div class="header">[Dev Chat :D] De los desarrolladores para los desarrolladores.</div>
		
            <input type="text"  id="Mensaje" placeholder="Mensaje"/>
        
        <div id="itemsContainer">
		 </div>
	<script src="socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script>
        
        function pastelColors(){
    var r = (Math.round(Math.random()* 127) + 127).toString(16);
    var g = (Math.round(Math.random()* 127) + 127).toString(16);
    var b = (Math.round(Math.random()* 127) + 127).toString(16);
    return '#' + r + g + b;
}
        
     $(document).ready(function(){
         $.color = pastelColors();
     });
        
	 var socket = io.connect('http://10.0.33.66:8899');
	  socket.on('news', function (data) {
	    var obj = '<div class="container" style="background-color:'+data.color+'">'+data.data+'</div> <div class="time"><time>'+new Date()+'</time></div>';
	    $('#itemsContainer').prepend(obj);
	    $(".header").fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);
	    socket.emit('my other event', { my: 'data' })
        notifyMe(data.data);
	  });
	
    $('#Mensaje').keyup(function(e){
    if(e.keyCode == 13)
    {
        $(this).trigger("enterKey");
    }
});
    
    $('#Mensaje').bind("enterKey",function(e){
        if($('#Mensaje').val()!=""){
            enviar();
        }
        
    });
    
        
        function enviar () {
             $.ajax({
                type: 'POST',
                url: 'http://10.0.33.66:8899/notificaciones',
                data: '{"data":'+'"'+$('#Mensaje').val()+'","color":"'+$.color+'"}',
                contentType: "application/json",
                success: function(data) {  $('#Mensaje').val(''); },
                dataType: 'json'
            });
        }
        
        function notifyMe(Mensaje) {
  // Let's check if the browser supports notifications
  if (!("Notification" in window)) {
    alert("This browser does not support desktop notification");
  }

  // Let's check if the user is okay to get some notification
  else if (Notification.permission === "granted") {
    // If it's okay let's create a notification
    var notification = new Notification(Mensaje);
  }

  // Otherwise, we need to ask the user for permission
  // Note, Chrome does not implement the permission static property
  // So we have to check for NOT 'denied' instead of 'default'
  else if (Notification.permission !== 'denied') {
    Notification.requestPermission(function (permission) {

      // Whatever the user answers, we make sure we store the information
      if(!('permission' in Notification)) {
        Notification.permission = permission;
      }

      // If the user is okay, let's create a notification
      if (permission === "granted") {
        var notification = new Notification(Mensaje);
      }
    });
  }

  // At last, if the user already denied any notification, and you 
  // want to be respectful there is no need to bother him any more.
} 
    
	</script>
	</body>
</html>
